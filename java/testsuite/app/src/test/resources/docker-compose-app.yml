version: "2.1"
services:
    rpisec-test-oauth-db:
        container_name: rpisec-test-oauth-db
        image: tobi312/rpi-postgresql:9.6
        environment:
            - POSTGRES_USER=rpisec-oauth
            - POSTGRES_PASSWORD=rpisec-oauth
            - POSTGRES_DATABASE=rpisec-oauth
        mem_limit: 64m
        cpu_shares: 2
    rpisec-test-oauth:
        container_name: rpisec-test-oauth
        build:
            context: ./oauth
        volumes:
            - ${OAUTH_APP_VOLUME}:/home/oauth/app:rw
            - ${OAUTH_CONF_VOLUME}:/home/oauth/conf:ro
            - ${OAUTH_LOG_VOLUME}:/home/oauth/log:rw
        environment:
            - OAUTH_JAVA_OPTS=-Dadmin.email=fh.ooe.mus.rpisec@gmail.com -Xms128m -Xmx200m
            - RPISEC_VERSION=${RPISEC_VERSION}
        mem_limit: 200m
        cpu_shares: 4
        depends_on:
            - rpisec-test-oauth-db
            - rpisec-test-app
